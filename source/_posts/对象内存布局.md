---
title: 对象内存布局
date: 2020-06-02 17:11:27
tags:
- java
- jvm
---

# 对象内存布局详解


```
Object o = new Object();
```
创建一个新对象的内存布局。
在一个64位系统中，一般安装的JVM也是64位，其指针也是64位的即8字节，但是一般开启了类型指针压缩，为4字节。
```
-XX:UseCompressedClassPointers //开启类型指针压缩
-XX:UseCompressedOops //开启普通指针压缩，对于堆内存低于4G会强制使用压缩指针，堆内存高于32G会强制使用8字节指针
```

一个Object对象包括8个字节的markword、被压缩过的类型指针ClassPointer 4个字节。两部分合起来12字节为对象头。
但是Object对象没有成员对象，大小为0，对象大小要8个字节对齐，为了提高cpu访问内存的效率，cpu访问内存数据是直接读取8个字节，如果跨段放不对齐就很有可能需要读取两次。

那么最后会补齐4个字节，一个Object对象的大小是16字节。如果没有开启类型指针压缩，一个Object对象仍然是16字节，因为不需要填充字节。

## 8字节的markword