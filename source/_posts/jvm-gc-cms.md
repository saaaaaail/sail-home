---
title: jvm垃圾收集器CMS
date: 2020-01-24 18:55:56
tags: 
- jvm
- cms
- gc
---
# jvm垃圾收集器CMS
CMS（Concurrent Mark Sweep）并发标记-清除算法。
分为四个步骤:
- 初始标记: 标记一下与GC roots直接关联的对象，需要全局暂停。 
- 并发标记: 进行GC roots tracing 过程，耗时最长，不用暂停，与用户线程并行。
- 重新标记: 对并发标记阶段，对象状态发生了变化的对象进行修改，需要全局暂停。
- 并发清除: 对前面阶段没有标记的对象进行清除，不用暂停，与用户线程并行。
  
优点:
- 并发收集
- 低停顿

CMS不足:
- 吞吐量低: 暂停时间短，导致gc时间多与用户线程争抢cpu，导致吞吐量低，cpu利用率不高。
- 无法处理浮动垃圾，可能出现Concurrent Mode Failure: 浮动垃圾是并发清除阶段，用户线程继续运行而产生的垃圾，这部分垃圾只能下一次GC的时候才能回收。如果预留的内存不足以存放浮动垃圾会出现Concurrent Mode Failure，此时jvm临时启用Serial Old来替代CMS。
- 标记-清除算法会产生内存碎片。